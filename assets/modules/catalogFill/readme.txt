
Модуль "Импорт/экспорт товаров" для MODx Evolution

Сделано для Shopkeeper (http://modx-shopkeeper.ru)

Используется PHP-класс PHPExcel (http://phpexcel.codeplex.com/)

-----------------

Описание:

Импорт/экспорт товаров каталога Shopkeeper или документов MODx.

-----------------

Возможности:

- Импорт и экспорт товаров каталога Shopkeeper а также документов MODx.
- Поддерживаются форматы файлов для импорта и экспорта: CSV, XLS, XLSX.
- Простая конфигурация. Можно настроить какой столбец куда (контент/TV-параметр) импортировать.
- Возможность создания конфигурационных файлов для разных задач. Конфигурацию можно выбрать перед импортом и экспортом.
- Индикатор загрузки файла.
- Режимы обновления (очистка до импорта) и добавления.
- Архивирование файлов. Все импортированные и экспортированные файлы хранятся на диске. Их можно удалить в любой момент.
- Поддержка категорий. Неограниченная вложенность.
- Возможность обновления данных товаров без их удаления (проверка соответствия по полю или значению TV).
- Возможность обновления категории товара при ее изменении в файле импорта (вместо создания дублей товаров в разных категориях).
- Включение/отключение обновления alias у страниц товаров.

-----------------

Требования:

- MODx Evolution 1.x.x, модуль/сниппет Shopkeeper 1.x.x (при использовании каталога SHK).
- кодировка сайта UTF-8
- PHP версии 5.2.0 или выше
- PHP расширение php_zip
- PHP расширение php_xml
- PHP расширение php_xmlwriter
- PHP расширение php_gd2

-----------------

Установка:

1. Загрузить папку catalogFill в assets/modules/ вашего сайта.
2. Установить права 777 на папки assets/modules/catalogFill/import/ и assets/modules/catalogFill/export/.
3. Войти в систему управления MODx.
4. Перейти "Модули" -> "Управление модулями" и нажать кнопку "Новый модуль".
5. Заполнить поля.
   Название модуля: Импорт/экспорт товаров
   Описание: Импорт/экспорт товаров каталога Shopkeeper или документов MODx
   Код модуля (php):
   require MODX_BASE_PATH."assets/modules/catalogFill/catalog_fill.inc.php";
6. Нажать кнопку "Сохранить" и обновить окно браузера.
7. Скопировать файл assets/modules/catalogFill/config/default.php, сохранить под другим именем и настроить параметры.
   В файле есть комментарии с описанием параметров.

-----------------

Инструкция по использованию:

1. Открыть модуль "Импорт/экспорт товаров".
2. Нажать на кнопку "Выбрать" и в дереве документов кликнуть документ-категорию, в/из которого нужно импортировать/экспортировать товары.

Импорт
3. Нажать кнопку "Импорт" и затем выбрать файл для импорта. Нажав кнопку "Обзор", можно загрузить новый файл. Из списка "файлы" можно выбрать для импорта ранее загруженный файл.
4. Выбрать конфигурацию для импорта в списке и нажать ещё раз кнопку "Импорт". В браузере появится индикация выполнения загрузки, нужно подождать завершения операции.

Экспорт
5. В дереве документов выберите категорию, из которой нужно экспортировать товары.
6. Нажать кнопку "Экспорт", выбрать формат файла и нажать повторно на кнопку "Экспорт".
7. Можно сразу скачать файл на жесткий диск вашего компьютера. Также экспортированные файлы хранятся в папке assets/modules/catalogFill/export/.

-----------------

Конфигурироание:

Для импорта и экспорта значений полей товаров (документов) в конфигурационном файле в массиве $cf_config['content_row'] нужно указать название столбца в файле, имя поля и тип содержимого.
Пример:
1 => array('Наименование',array('pagetitle','content')),

---

Для импорта и экспорта TV-параметров нужно указать название столбца в файле, ID TV-параметра и тип содержимого.
Пример:
2 => array('Цена',array(7,'tv'))

---

Для импорта и экспорта категорий нужно указать название столбца в файле, ID шаблона категории и тип содержимого.
Пример:
0 => array('Категория',array(7,'category')),

7 - ID шаблона для категории.
Категории в файле должны идти последовательно от верхнего уровня к нижнему.

---

Предусмотрена возможность обновления данных товаров без их удаления (сохраняются ID).
Проверку на соответствие существующего товара и импортируемого можно осуществлять по полям (в БД) товара или значениям его TV-параметров.

Примеры:
$cf_config['imp_chk_field'] = 'pagetitle'; //Если найден товар с названием соответствующим названию импортируемого товара, его данные будут обновлены.

$cf_config['imp_chk_tvid_val'] = 10; //Проверка соответствия происходит по значению TV-парамтера с ID 10. Например это может быть артикул.

---

Для программистов есть возможность сделать обработку значений перед импортом или экспортом. Смотреть пример в конфигурационном файле.

-----------------

При необходимости добавить в файл .htaccess (сервер Apache) строки чтобы снять ограничения:

php_value memory_limit 128M
php_value upload_max_filesize 15M
php_value post_max_size 15M
php_value max_input_time 1200
php_value max_execution_time 1200

